# üè¶ Rofan Bank API

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–µ API, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Gin, PostgreSQL –∏ Docker.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker & Docker Compose
- Go 1.24+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- Make (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd roflan_bank

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
make prod-up

# –ò–ª–∏ –±–µ–∑ Make
docker-compose -f docker-compose.prod.yaml up -d
```

### –ó–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ PostgreSQL
make dev-postgres

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
make dev-up

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ
make server
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
roflan_bank/
‚îú‚îÄ‚îÄ api/                 # HTTP API handlers
‚îú‚îÄ‚îÄ db/                  # Database layer
‚îÇ   ‚îú‚îÄ‚îÄ migration/       # SQL migrations
‚îÇ   ‚îú‚îÄ‚îÄ sqlc/           # Generated SQL code
‚îÇ   ‚îî‚îÄ‚îÄ util/           # Database utilities
‚îú‚îÄ‚îÄ token/              # JWT/PASETO token management
‚îú‚îÄ‚îÄ Dockerfile          # Multi-stage Docker build
‚îú‚îÄ‚îÄ docker-compose.yaml # Development environment
‚îú‚îÄ‚îÄ docker-compose.prod.yaml # Production environment
‚îî‚îÄ‚îÄ Makefile           # Build and deployment commands
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example` (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç). –≠—Ç–æ—Ç —Ñ–∞–π–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è, —Ç–∞–∫ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è `.env`:
```env
# Database
POSTGRES_USER=root
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=simple_bank

# Server
SERVER_ADDRESS=0.0.0.0:8080
ENVIRONMENT=production

# JWT
TOKEN_SYMMETRIC_KEY=your_32_character_key
ACCESS_TOKEN_DURATION=15m
REFRESH_TOKEN_DURATION=24h

# Redis (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
REDIS_ADDRESS=redis:6379
REDIS_PASSWORD=your_redis_password
```

## üê≥ Docker –∫–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
make build-image

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
make prod-up

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make prod-logs

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make prod-down

# –û—á–∏—Å—Ç–∫–∞
make clean
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```bash
# –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
make security-scan
```

## üìä API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ endpoints
- `GET /health` - Health check
- `POST /users` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /users/login` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints (—Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω)
- `POST /accounts` - –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞
- `GET /accounts/:id` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–∞
- `GET /accounts` - –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
- `POST /transfers` - –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- `POST /tokens/renew_access` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ JWT/PASETO —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ Rate limiting (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
- ‚úÖ –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ Docker –æ–±—Ä–∞–∑—ã (scratch)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
3. –í–∫–ª—é—á–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è PostgreSQL
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ secrets management –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Checks
- API: `GET /health`
- PostgreSQL: `pg_isready`
- Redis: `redis-cli ping`

### –ú–µ—Ç—Ä–∏–∫–∏
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make ps

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
make stats
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-coverage

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤
make mock
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
make migrateup

# –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
make migratedown

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é
make migrateup1

# –û—Ç–∫–∞—Ç–∏—Ç—å –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é
make migratedown1
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Kubernetes
```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
make k8s-deploy

# –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞
make k8s-delete
```

### Docker Registry
```bash
# –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞
make build-image
make push-image
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ stdout/stderr –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Docker –∏ Kubernetes.

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- `debug` - –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `info` - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `warn` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `error` - –û—à–∏–±–∫–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã, –≤—ã–ø–æ–ª–Ω–∏—Ç —Ç–µ—Å—Ç—ã –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–µ—Ä–≤–∏—Å—ã –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

```bash
# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ E2E —Ç–µ—Å—Ç–∞
make test-e2e
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–ï—Å–ª–∏ –≤—ã —É–∂–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å–µ—Ä–≤–∏—Å—ã —Å –ø–æ–º–æ—â—å—é `make dev-up`, –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
make test-logging
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
make logs-api

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—é
make logs-filtered

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö JSON –ª–æ–≥–æ–≤
make logs-json
```

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

#### HTTP –∑–∞–ø—Ä–æ—Å—ã:
```json
{
  "level": "INFO",
  "msg": "HTTP Request",
  "method": "POST",
  "path": "/users",
  "client_ip": "172.18.0.1",
  "user_agent": "curl/7.68.0",
  "status_code": 200,
  "duration_ms": 45.2
}
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```json
{
  "level": "INFO",
  "msg": "Creating new user",
  "username": "john_doe",
  "email": "john@example.com",
  "client_ip": "172.18.0.1"
}
```

#### –û—à–∏–±–∫–∏:
```json
{
  "level": "ERROR",
  "msg": "Failed to create user in database",
  "error": "pq: duplicate key value violates unique constraint"
}
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **PostgreSQL –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
   docker-compose logs postgres
   
   # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ volume
   docker-compose down -v
   docker-compose up -d
   ```

2. **API –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   docker-compose exec api env | grep DB
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å
   docker network ls
   ```

3. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è**
   ```bash
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
   docker-compose exec migrate migrate -path /app/migration -database "postgresql://root:secret@postgres:5432/simple_bank?sslmode=disable" up
   ```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üë• –ê–≤—Ç–æ—Ä—ã

- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: [–í–∞—à–µ –∏–º—è]
- –ö–æ–Ω—Ç–∞–∫—Ç—ã: [email@example.com] 